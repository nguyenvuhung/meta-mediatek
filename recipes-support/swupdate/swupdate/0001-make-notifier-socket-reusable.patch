From 53089bdb87b724112fe33aea18a1d80806697b9f Mon Sep 17 00:00:00 2001
From: hungnv9 <hungnv9@vng.com.vn>
Date: Sat, 18 Jan 2020 20:26:39 +0700
Subject: [PATCH] make notifier socket reusable

---
 core/notifier.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/core/notifier.c b/core/notifier.c
index 8643c6f..13d1618 100644
--- a/core/notifier.c
+++ b/core/notifier.c
@@ -259,6 +259,7 @@ static void *notifier_thread (void __attribute__ ((__unused__)) *data)
 {
 	int serverfd;
 	int len;
+        int sock_optval = 1;
 	int attempt = 0;
 	struct notify_ipc_msg msg;
 
@@ -269,6 +270,13 @@ static void *notifier_thread (void __attribute__ ((__unused__)) *data)
 		exit(2);
 	}
 
+	if ((setsockopt(serverfd, SOL_SOCKET, SO_REUSEADDR,
+					 &sock_optval, sizeof(sock_optval))) < 0) {
+		TRACE("Error setting socket options: %s", strerror(errno));
+		close(serverfd);
+		exit(2);
+	}
+
 #if defined(__FreeBSD__)
 	setup_socket_cleanup(&notify_server);
 #endif
-- 
2.7.4

